# EGSNotifier

**EGSNotifier** — Telegram-бот для уведомлений о бесплатных раздачах в Epic Games Store.
Проект получает актуальные акции из EGS, сохраняет их в базу данных и отправляет подписчикам уведомления с карточкой игры и ссылкой на страницу в магазине.

## Что умеет

- Подписывает пользователя на уведомления через команду `/start`.
- Показывает активные бесплатные игры сразу после подписки.
- Регулярно проверяет новые раздачи в Epic Games Store.
- Отправляет уведомления всем активным подписчикам.
- Автоматически деактивирует пользователя, если бот удалён/заблокирован.

## Технологии

- **.NET 9** (основная платформа).
- **Telegram.Bot** — работа с Telegram Bot API.
- **Entity Framework Core 9** + **Npgsql** — доступ к PostgreSQL и миграции.
- **Quartz.NET** — планирование фоновых обновлений данных.
- **Newtonsoft.Json (JObject)** — разбор ответа API Epic Games Store.
- **ASP.NET Core** — режим работы через webhook.

## Структура проекта

- `Core` — общая бизнес-логика:
  - клиент Telegram-бота;
  - парсер бесплатных игр EGS;
  - уведомления;
  - задания Quartz;
  - EF Core контекст и сущности.
- `LongPolling` — запуск бота в режиме long polling.
- `WebHook` — запуск бота в режиме webhook (HTTP endpoint для Telegram).

## Как это работает

1. При старте инициализируется `TelegramBot`, применяется миграция БД и запускается фоновая задача обновления.
2. Парсер запрашивает `freeGamesPromotions` у Epic Games Store, фильтрует бесплатные предложения и преобразует их в сущности `EGS`.
3. Новые игры сохраняются в PostgreSQL.
4. При появлении новых позиций модуль уведомлений рассылает подписчикам сообщение с обложкой, описанием, сроками акции и кнопкой `Game Page`.
5. По команде `/start` пользователь подписывается и получает список текущих активных бесплатных игр.

## Переменные окружения

Перед запуском необходимо задать:

- `TelegramBotToken` — токен Telegram-бота.
- `TelegramBotConnectionString` — строка подключения к PostgreSQL.

Пример для Linux/macOS:

```bash
export TelegramBotToken="<your_bot_token>"
export TelegramBotConnectionString="Host=localhost;Port=5432;Database=egs;Username=postgres;Password=postgres"
```
